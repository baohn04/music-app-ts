extends ../../layouts/default.pug
include ../../mixins/alert.pug
include ../../mixins/filter-status.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/sort.pug

block main
  if(role.permissions.includes("topics_view"))
    +alert-success(3000)
    +alert-error(3000)

    h1(class="mb-4") #{pageTitle}

    .card.mb-3 
      .card-header Bộ lọc và Tìm kiếm 
      .card-body
        .row
          .col-6
            +filter-status(filterStatus)
          .col-6
            +search(keyword)
    
    .card.mb-3 
      .card-header Sắp xếp 
      .card-body 
        .row 
          .col-4 
            +sort()

    .card.mb-3 
      .card-header Danh sách chủ đề
      .card-body 
        .row 
          .col-8 
          .col-4.text-right 
            if(role.permissions.includes("topics_create"))
              a(
                href=`${prefixAdmin}/topics/create`
                class="btn btn-outline-success"
              ) + Thêm mới

        table(
            class="table table-hover table-sm"
            checkbox-multi
          ) 
            thead 
              tr 
                th STT
                th Hình ảnh
                th Tiêu đề
                th Mô tả
                th Vị trí
                th Trạng thái
                th Hành động

            tbody
              each item, index in topics 
                tr 
                  td #{index + 1}
                  td 
                    img(
                      src=item.avatar 
                      alt=item.title
                      width="100px"
                      height="auto"
                    )
                  td #{item.title}
                  td !{item.description}
                  td #{item.position}
                  td
                    if(role.permissions.includes("topics_edit"))
                      if(item.status == "active")
                        a(
                          href="javascript:;"
                          data-id=item.id
                          data-status=item.status
                          button-change-status 
                          class="badge badge-success"
                        ) Hoạt động
                      else 
                        a(
                          href="javascript:;"
                          data-id=item.id
                          data-status=item.status
                          button-change-status
                          class="badge badge-danger"
                        ) Dừng hoạt động
                  td
                    if(role.permissions.includes("topics_edit"))
                      a(
                        href=`${prefixAdmin}/topics/edit/${item.id}`
                        class="btn btn-warning btn-sm"
                      ) Sửa 
                  
                    a(
                      href=`${prefixAdmin}/topics/detail/${item.id}`
                      class="btn btn-secondary btn-sm"
                    ) Chi tiết
                    if(role.permissions.includes("topics_delete"))
                      button(
                        class="btn btn-danger btn-sm"
                        button-delete
                        data-id=item.id
                      ) Xóa

    +pagination(pagination)

    //- Form delete item
    form(
      action=""
      method="POST"
      id="form-delete-item"
      data-path=`${prefixAdmin}/topics/delete`
    )

    //- Form change status
    form(
      action=""
      method="POST"
      id="form-change-status"
      data-path=`${prefixAdmin}/topics/change-status`
    )
  else 
    h1 Bạn không có quyền truy cập vào trang này